<!DOCTYPE html> <html lang="pl"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1" /> <title>Gynveal's Mission 003&#58; Optymalizacja · Rafal Makara</title> <meta property="og:title" content=" Gynveal's Mission 003&#58; Optymalizacja "> <meta property="twitter:title" content=" Gynveal's Mission 003&#58; Optymalizacja "> <meta property="og:description" content=" Hi! I am Rafal and I am a generalist. I was an software engineer, project manager, product owner, scrum master, chief digital officer. I know about people, collaboration, project management, software development and business operations. "> <meta name="twitter:card" content="summary" /> <meta name="twitter:site" content="@rafalmakara" /> <meta property="og:image" content="https://rmakara.github.io/assets/20170528_header.jpg" /> <meta name="twitter:image" content="https://rmakara.github.io/assets/20170528_header.jpg" /> <meta name="description" content="Wystarczy poczekać"> <link rel="icon" href="https://rmakara.github.io//assets/favicon.ico"> <link rel="apple-touch-icon" href="https://rmakara.github.io//assets/apple-touch-icon.png"> <link rel="stylesheet" href="https://rmakara.github.io//assets/core.css"> <link rel="canonical" href="https://rmakara.github.io//Gynveals-Mission-003-Optymalizacja"> <link rel="alternate" type="application/atom+xml" title="Rafal Makara" href="https://rmakara.github.io/feed.xml" /> </head> <body> <aside class="logo"> <a href="https://rmakara.github.io//"> <img src="https://avatars0.githubusercontent.com/u/1880231?v=4" class="logo-avatar"> </a> <span class="logo-prompt code">Back to Home</span> </aside> <p class="menu"> <a href="/">EN Articles</a> | <a href="/pl">PL Articles</a> <br /> <a href="/about">About me</a> | <a href="/help">How can I help?</a> | <a href="https://www.linkedin.com/in/rafalmakara/">My LinkedIn Profile</a> </p> <div id="content"> <article> <div class="center"> <h1 class="title">Gynveal's Mission 003&#58; Optymalizacja</h1> <time class="code">2017-05-28</time> </div> <div class="divider"></div> <h1 id="wystarczy-poczekać">Wystarczy poczekać</h1> <p>Powodem pominięcia Misji 002 jest fakt, że trudno było mi wpaść na pomysł jej rozwiązania. Uznałem, że na dzień dzisiejszy potrzebuję czegoś bardziej trywialnego, a taka wydała się być Misja 003. Z czasem jednak wrócę do wykonania również zadania drugiego.</p> <p>Misja 003 zawiera gotowy do wykonania kod, który pokaże nam poszukiwane hasło.</p> <blockquote> <p><strong>Misja 003</strong><br /> <strong>DIFFICULTY: [2/10]</strong></p> <p>Tym razem nie trzeba nic robić. Wystarczy uruchomić poniższy skrypt, chwilkę poczekać, a hasło zostanie wypisane. No, taką dłuższą chwilkę…</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/usr/bin/python
def magic1(a, b):
  o = 0
  i = 0
  while i &lt; a:
    o += 1
    i += 1
  i = 0

  while i &lt; b:
    o += 1
    i += 1
  return o

def magic2(a, b):
  o = 0
  i = 0
  while i &lt; b:
    o = magic1(o, a)
    i += 1
  return o

n1 = int("2867279575674690971609643216365"
         "4161626212087501848651843132337"
         "3373323997065608342")

n2 = int("1240905467219837578349182398365"
         "3459812983123659128386518235966"
         "4109783723654812937")

n = magic2(magic1(n1, n2), 1337)
print hex(n)[2:-1].decode("hex").splitlines()[0]

</code></pre></div> </div> </blockquote> <p>Na pierwszy rzut oka program wygląda bardzo prosto. Poziom zadania określony jako 2/10 popiera tezę mówiącą o tym, że wystarczy uruchomić skrypt. W celu rozwiązania zadania ściągamy kod, zapisujemy w pliku <code class="language-plaintext highlighter-rouge">Gynveal_003.py</code> i wykonujemy. Po dopiciu kawy tracimy nadzieję na otrzymanie wyniku jego działania i podejmujemy decyzję o przejściu do optymalizacji.</p> <h1 id="analiza">Analiza</h1> <p>W kodzie aplikacji mamy dwie zmienne <code class="language-plaintext highlighter-rouge">n1</code> oraz <code class="language-plaintext highlighter-rouge">n2</code> przechowujące bardzo duże wartości całkowite, które następnie wykorzystywane są jako parametry metody <code class="language-plaintext highlighter-rouge">magic1(n1, n2)</code>. Ta następnie jest wykorzystywana jako parametr metody <code class="language-plaintext highlighter-rouge">magic2(magic1(n1, n2), 1337)</code>. Żartobliwie, ostatnim parametrem jest <a href="https://pl.wikipedia.org/wiki/Leet_speak">leet</a> popularyzowany w społeczności IRCowej już kilkanaście lat temu.</p> <p>Przeanalizujmy metodę <code class="language-plaintext highlighter-rouge">magic1(a, b)</code>:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">magic1</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
  <span class="n">o</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">:</span>
    <span class="n">o</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
  <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>

  <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">:</span>
    <span class="n">o</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
  <span class="k">return</span> <span class="n">o</span>

</code></pre></div></div> <p>Zauważamy, że zawiera ona dwie pętle w których liczba przebiegów jest uwarunkowana od <code class="language-plaintext highlighter-rouge">a</code> oraz <code class="language-plaintext highlighter-rouge">b</code>, czyli parametrów przekazywanych do metody. Pamiętając o naszych dwóch dużych zmiennych spostrzegamy, że daje nam to 4.108185e+80 iteracji. W ramach każdego z kolejnych przebiegów wartości zmiennych <code class="language-plaintext highlighter-rouge">o</code> oraz <code class="language-plaintext highlighter-rouge">i</code> są sobie równe. Po zakończeniu pętli <code class="language-plaintext highlighter-rouge">i</code> wartość zmiennej jest zerowana w ramach przygotowania do wykonania kolejnej. Zmienna <code class="language-plaintext highlighter-rouge">o</code> natomiast zerowana nie jest, a jest inkrementowana dalej w drugiej pętli, której liczba przebiegów jest zdefiniowana przez wartość parametru <code class="language-plaintext highlighter-rouge">b</code>.</p> <p>W efekcie, pierwsza pętla ustawia wartość zmiennej <code class="language-plaintext highlighter-rouge">o</code> na równą parametrowi <code class="language-plaintext highlighter-rouge">a</code>, a druga pętla zwiększa wartość zmiennej <code class="language-plaintext highlighter-rouge">o</code> o wartość parametru <code class="language-plaintext highlighter-rouge">b</code>. Innymi słowy, metoda <code class="language-plaintext highlighter-rouge">magic1(a, b)</code> realizuje operację dodawania. Możemy ją przekształcić do postaci:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def magic1(a, b)
  return a + b

</code></pre></div></div> <p>Druga z magicznych metod <code class="language-plaintext highlighter-rouge">magic2(a, b)</code> na pierwszy rzut oka wygląda dość podobnie:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">magic2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
  <span class="n">o</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">:</span>
    <span class="n">o</span> <span class="o">=</span> <span class="n">magic1</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
  <span class="k">return</span> <span class="n">o</span>

</code></pre></div></div> <p>Wewnętrz pętli zawarte jest jednak wywołanie metody <code class="language-plaintext highlighter-rouge">magic1(o, a)</code>. Podobnie jak w poprzednim przypadku <code class="language-plaintext highlighter-rouge">i</code> jest inkrementowane, aż do uzyskania wartości równej parametrowi <code class="language-plaintext highlighter-rouge">b</code>. Zaczynamy z wartością <code class="language-plaintext highlighter-rouge">o</code> ustawioną na 0. Wewnątrz pętli, do wartości <code class="language-plaintext highlighter-rouge">o</code> jest przypisywany wynik dodawania otrzymany z metody <code class="language-plaintext highlighter-rouge">magic1(o, a)</code>, czyli suma aktualnej wartości parametru <code class="language-plaintext highlighter-rouge">o</code> i naszej dużej zmiennej <code class="language-plaintext highlighter-rouge">a</code>, dzieje się to tyle razy ile wynosi wartość zmiennej <code class="language-plaintext highlighter-rouge">b</code>. Oznacza to, że metoda realizuję operację mnożenia. Optymalizujemy przekształcając do postaci:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">magic2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>

</code></pre></div></div> <p>Finalna wersja naszego zoptymalizowanego programu wygląda następująco:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">magic1</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="k">def</span> <span class="nf">magic2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>

<span class="n">n1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="s">"2867279575674690971609643216365"</span>
         <span class="s">"4161626212087501848651843132337"</span>
         <span class="s">"3373323997065608342"</span><span class="p">)</span>

<span class="n">n2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="s">"1240905467219837578349182398365"</span>
         <span class="s">"3459812983123659128386518235966"</span>
         <span class="s">"4109783723654812937"</span><span class="p">)</span>

<span class="n">n</span> <span class="o">=</span> <span class="n">magic2</span><span class="p">(</span><span class="n">magic1</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">),</span> <span class="mi">1337</span><span class="p">)</span>
<span class="k">print</span> <span class="n">n</span>
<span class="k">print</span> <span class="nb">hex</span><span class="p">(</span><span class="n">n</span><span class="p">)[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="n">decode</span><span class="p">(</span><span class="s">"hex"</span><span class="p">).</span><span class="n">splitlines</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

</code></pre></div></div> <p>Jego wykonanie zwraca wynik:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">n</span> <span class="o">=</span> <span class="mi">549264340234998467129494984689502898642039973222263002891494221114915022603203250023</span>

</code></pre></div></div> <p>Ostatnia linia konwertuje wartość zapisaną w systemie dziesiętnym na system szesnastkowy. Wycina początkowe <code class="language-plaintext highlighter-rouge">0x</code> z notacji i dekoduje wszystkie kolejne bajty, aż do ostatniego znaku, tym samym zwracając:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Haslo</span><span class="p">:</span> <span class="s">"WolneOprogramowanie!"</span>

</code></pre></div></div> <h1 id="podsumowanie">Podsumowanie</h1> <p>Mi osobiście po realizacji tego zadania do głowy dwa wnioski. Pierwszy z nich to cytat:</p> <blockquote> <p>Premature optimization is the root of all evil.</p> <p>– Donald Knuth</p> </blockquote> <p>Zakładając, że kod z zadania byłby kodem produkcyjnym można byłoby wyobrazić sobie, że przyjęte rozwiązanie było wydajne, dobre i szybkie do zaimplementowania w początkowym okresie istnienia systemu. Bardzo dobrze, że na tym etapie nie było optymalizowane. Dopiero gdy nasze wielkie liczby niepozwoliły na jego wykonanie mogliśmy upewnić się, że cały system działa poprawnie dla mniejszych danych, mogliśmy zmierzyć wydajność jego działania przy użyciu <a href="https://en.wikipedia.org/wiki/Profiling_(computer_programming)">profilera</a> i wykazać wąskie gardła, a dopiero w kolejnych kroku zabrać się za optymalizację optymalizację. Problem ten został szczegółowo omówiony w artykule <a href="http://wiki.c2.com/?PrematureOptimization">Premature Optimization</a>.</p> <p>Drugim z wniosków jest ponownie popularny cytat:</p> <blockquote> <p>Done is better than perfect.</p> </blockquote> <p>Branża IT cechuje się tym, że przy realizacji projektów istniejących wystarczająco długo perfekcjonizm można włożyć między bajki. W pełni czyste podejście do wytwarzania oprogramowania często okaże się być jednym z większym wrogów. Należy pamiętać, że pracą programistów nie jest pisanie wspaniałych klas, zyskiwania milisekund na rzadko wykonywanych operacjach, sprowadzanie wysokopoziomowych operacji do żonglowania wartościami między rejestrami przy użyciu assembly. Naszym zadaniem jest dostarczanie wartościowych dla klienta rozwiązań problemów, które będą dla niego jak najlepsze w danym czasie lub w spojrzeniu perspektywicznym. To jednak nie oznacza perfekcjonizmu. Jako uzupełnienie tego wniosku warto przytoczyć <a href="http://www.manifestoproject.it/bre-pettis-and-kio-stark/">The Cult of Done Manifesto</a> z którego moimi ulubionymi elementami są:</p> <blockquote> <p>2.Accept that everything is a draft. It helps to get done.</p> <p>5.Banish procrastination. If you wait more than a week to get an idea done, abandon it.</p> <p>10.Failure counts as done. So do mistakes.</p> </blockquote> <h4 id="źródła-i-pojęcia">Źródła i pojęcia</h4> <ul> <li>[1] <a href="https://www.youtube.com/watch?v=xR0hAJPp1vs">Gynvael’s Livestream #39: RPC, czyli zdalne API</a></li> <li>[2] <a href="https://pl.wikipedia.org/wiki/Leet_speak">Leet speak, Wikipedia</a></li> <li>[3] <a href="https://en.wikipedia.org/wiki/Profiling_(computer_programming)">Profiling, Wikipedia</a></li> <li>[4] <a href="http://wiki.c2.com/?PrematureOptimization">Premature Optimization, Donald Knuth</a></li> <li>[5] <a href="http://www.manifestoproject.it/bre-pettis-and-kio-stark/">The Cult of Done Manifesto</a></li> </ul> </article> <div class="page-navigation code"> <a class="prev" href="https://rmakara.github.io//Gynveals-Mission-001-Szyfrowanie-XORem" title="PREV: Gynveal's Mission 001&#58; Szyfrowanie XORem">Previous article</a> <span> &middot; </span> <a class="home" href="https://rmakara.github.io/" title="Back to Home">Back to Home</a> <span> &middot; </span> <a class="next" href="https://rmakara.github.io//Developer-vs-Project-Manager-001-Wiedza-o-projekcie" title="NEXT: Developer vs Project Manager 001&#58; Wiedza o projekcie">Next article</a> </div> </div> <div class="footer"> <span class="block">&copy; 2021 Rafal Makara</span> <span class="block"><small>&lt;/&gt; Powered by <a href="https://jekyllrb.com/">Jekyll</a> and <a href="https://github.com/heiswayi/the-plain">The Plain theme</a>.</small></span> </div> </body> </html>
